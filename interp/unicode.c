/* Copyright (C) 2000 - 2001 Hangil Chang

   This file is part of KSM-Scheme, Kit for Scheme Manipulation Scheme.
   
   KSM-Scheme is free software; you can distribute it and/or modify it
   under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2, or (at your option)
   any later version.
  
   KSM-Scheme is distributed in the hope that it will be useful, but
   WITHOUT ANY WARRANTY; without even implied warranty of MERCHANTABILITY
   or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
   License for more details.

   You should have received a copy of the GNU General Public License
   along with KSM-Scheme; see the file COPYING. If not, write to the
   Free Software Foundation, 59 Temple Place, Suite 330, Boston,
   MA 02111 USA.                                                   */

#include <ctype.h>

/***
    a[0], a[1], a[2], ..., a[N-1]
    i = N/2;
    a[0], a[1], ..., a[i-1], a[i], a[i+1], ..., a[N-1]
 ***/

static
int bsearch(int code, int *a, int N)
{
  int i, x;

 again:
  if( N <= 0 )
    return 0;
  i = N / 2;
  x = a[i];
  if( x == code )
    return 1;
  if( code < x ){
    N = i;
    goto again;
  }
  else{
    N -= (i+1);
    a += (i+1);
    goto again;
  }
}

typedef struct {
  int left;
  int right;
} range;

static range ups1[] = {  /*** GLOBAL ***/
  { 0x0041, 0x005A },
  { 0x00C0, 0x00D6 },
  { 0x00D8, 0x00DE },
  { 0x0391, 0x03A1 },
  { 0x03A3, 0x03AB },
  { 0x0400, 0x042F },
  { 0x0531, 0x0556 },
  { 0x10A0, 0x10C5 },
  { 0x1F08, 0x1F0F },
  { 0x1F18, 0x1F1D },
  { 0x1F28, 0x1F2F },
  { 0x1F38, 0x1F3F },
  { 0x1F48, 0x1F4D },
  { 0x1F68, 0x1F6F },
  { 0x1FB8, 0x1FBB },
  { 0x1FC8, 0x1FCB },
  { 0x1FD8, 0x1FDB },
  { 0x1FE8, 0x1FEC },
  { 0x1FF8, 0x1FFB },
  { 0xFF21, 0xFF3A },
  { 0, 0 }
};

static range ups2[] = {   /*** GLOBAL ***/
  { 0x0100, 0x0136 },   // (skip 1)
  { 0x014A, 0x0178 },   // (skip 1)
  { 0x01F8, 0x021E },   // (skip 1)
  { 0x0222, 0x0232 },   // (skip 1)
  { 0x03DA, 0x03EE },   // (skip 1)
  { 0x0460, 0x0480 },   // (skip 1)
  { 0x0490, 0x04C0 },   // (skip 1)
  { 0x04D0, 0x04F8 },   // (skip 1)
  { 0x1E00, 0x1E94 },   // (skip 1)
  { 0x1EA0, 0x1EF8 },   // (skip 1)
  { 0, 0 }
};

static int ups3[] = {  /*** GLOBAL ***/
  0x0181,
  0x0182,
  0x0184,
  0x0186,
  0x0187,
  0x0189,
  0x018A,
  0x018B,
  0x018E,
  0x018F,
  0x0190,
  0x0191,
  0x0193,
  0x0194,
  0x0196,
  0x0197,
  0x0198,
  0x019C,
  0x019D,
  0x019F,
  0x01A0,
  0x01A2,
  0x01A4,
  0x01A6,
  0x01A7,
  0x01A9,
  0x01AC,
  0x01AE,
  0x01AF,
  0x01B1,
  0x01B2,
  0x01B3,
  0x01B5,
  0x01B7,
  0x01B8,
  0x01BC,
  0x01C4,
  0x01C7,
  0x01CA,
  0x01CD,
  0x01CF,
  0x01D1,
  0x01D3,
  0x01D5,
  0x01D7,
  0x01D9,
  0x01DB,
  0x01DE,
  0x01E0,
  0x01E2,
  0x01E4,
  0x01E6,
  0x01E8,
  0x01EA,
  0x01EC,
  0x01EE,
  0x01F1,
  0x01F4,
  0x01F6,
  0x01F7,
  0x0386,
  0x0388,
  0x0389,
  0x038A,
  0x038C,
  0x038E,
  0x038F,
  0x03D2,
  0x03D3,
  0x03D4,
  0x048C,
  0x048E,
  0x04C1,
  0x04C3,
  0x04C7,
  0x04CB,
  0x1F59,
  0x1F5B,
  0x1F5D,
  0x1F5F,
  0x2102,
  0x2107,
  0x210B,
  0x210C,
  0x210D,
  0x2110,
  0x2111,
  0x2112,
  0x2115,
  0x2119,
  0x211A,
  0x211B,
  0x211C,
  0x211D,
  0x2124,
  0x2126,
  0x2128,
  0x212A,
  0x212B,
  0x212C,
  0x212D,
  0x2130,
  0x2131,
  0x2133
};

int ksm_unicode_isupper(int code)
{
  range *p;

  p = &ups1[0];
  while( p->left != 0 ){
    if( p->left <= code && code <= p->right )
      return 1;
    ++p;
  }
  p = &ups2[0];
  while( p->left != 0 ){
    if( p->left <= code && code <= p->right )
      return (code & 1) == 0;
    ++p;
  }
  if( code >= 0x0139 && code <= 0x017d )
    return code & 1;
  return bsearch(code, &ups3[0], sizeof(ups3)/sizeof(int));
}

static range dns1[] = {   /*** GLOBAL ***/
  { 0x61, 0x7a },
  { 0xdf, 0xf6 },
  { 0xf8, 0xff },
  { 0x17e, 0x180 },
  { 0x199, 0x19b },
  { 0x1bd, 0x1bf },
  { 0x250, 0x2ad },
  { 0x3ac, 0x3ce },
  { 0x3d5, 0x3d7 },
  { 0x3ef, 0x3f3 },
  { 0x430, 0x45f },
  { 0x561, 0x587 },
  { 0x1e95, 0x1e9b },
  { 0x1f00, 0x1f07 },
  { 0x1f10, 0x1f15 },
  { 0x1f20, 0x1f27 },
  { 0x1f30, 0x1f37 },
  { 0x1f40, 0x1f45 },
  { 0x1f50, 0x1f57 },
  { 0x1f60, 0x1f67 },
  { 0x1f70, 0x1f7d },
  { 0x1f80, 0x1f87 },
  { 0x1f90, 0x1f97 },
  { 0x1fa0, 0x1fa7 },
  { 0x1fb0, 0x1fb4 },
  { 0x1fc2, 0x1fc4 },
  { 0x1fd0, 0x1fd3 },
  { 0x1fe0, 0x1fe7 },
  { 0x1ff2, 0x1ff4 },
  { 0xfb00, 0xfb06 },
  { 0xfb13, 0xfb17 },
  { 0xff41, 0xff5a },
  { 0, 0 }
};

static range dns2[] = {  /*** GLOBAL ***/
  { 0x101, 0x137 },
/* 0x138, 0x148, */
  { 0x149, 0x177 },
  { 0x1a1, 0x1a5 },
/* 0x1cc, 0x1dc, */
  { 0x1dd, 0x1ef },
  { 0x1f9, 0x21f },
  { 0x223, 0x233 },
  { 0x3db, 0x3ed },
  { 0x461, 0x481 },
  { 0x48d, 0x4bf },
  { 0x4d1, 0x4f5 },
  { 0x1e01, 0x1e93 },
  { 0x1ea1, 0x1ef9 },
  { 0, 0 }
};

static int dns3[] = {
  0xaa,
  0xb5,
  0xba,
  0x17a,
  0x17c,
  0x183,
  0x185,
  0x188,
  0x18c,
  0x18d,
  0x192,
  0x195,
  0x19e,
  0x1a8,
  0x1aa,
  0x1ab,
  0x1ad,
  0x1b0,
  0x1b4,
  0x1b6,
  0x1b9,
  0x1ba,
  0x1c6,
  0x1c9,
  0x1f0,
  0x1f3,
  0x1f5,
  0x390,
  0x3d0,
  0x3d1,
  0x4c2,
  0x4c4,
  0x4c8,
  0x4cc,
  0x4f9,
  0x1fb6,
  0x1fb7,
  0x1fbe,
  0x1fc6,
  0x1fc7,
  0x1fd6,
  0x1fd7,
  0x1ff6,
  0x1ff7,
  0x207f,
  0x210a,
  0x210e,
  0x210f,
  0x2113,
  0x212f,
  0x2134,
  0x2139
};

int ksm_unicode_islower(int code)
{
  range *p;

  p = &dns1[0];
  while( p->left != 0 ){
    if( p->left <= code && code <= p->right )
      return 1;
    ++p;
  }
  p = &dns2[0];
  while( p->left != 0 ){
    if( p->left <= code && code <= p->right )
      return code & 1;
    ++p;
  }
  if( (code >= 0x0138 && code <= 0x0148) ||
      (code >= 0x01cc && code <= 0x01dc) )
    return (code & 1) == 0;
  return bsearch(code, &dns3[0], sizeof(dns3)/sizeof(int));
}

typedef struct {
  int left;
  int right;
} pair;

/***
    a[0], a[1], a[2], ..., a[N-1]
    i = N/2;
    a[0], a[1], ..., a[i-1], a[i], a[i+1], ..., a[N-1]
 ***/

static
pair *bsearch_pair(int code, pair *a, int N)
{
  int i;
  pair *p;

 again:
  if( N <= 0 )
    return 0;
  i = N / 2;
  p = &a[i];
  if( p->left == code )
    return p;
  if( code < p->left ){
    N = i;
    goto again;
  }
  else{
    N -= (i+1);
    a += (i+1);
    goto again;
  }
}

static pair to_upper[] = {  /*** GLOBAL ***/
  { 0X61, 0X41 },
  { 0X62, 0X42 },
  { 0X63, 0X43 },
  { 0X64, 0X44 },
  { 0X65, 0X45 },
  { 0X66, 0X46 },
  { 0X67, 0X47 },
  { 0X68, 0X48 },
  { 0X69, 0X49 },
  { 0X6A, 0X4A },
  { 0X6B, 0X4B },
  { 0X6C, 0X4C },
  { 0X6D, 0X4D },
  { 0X6E, 0X4E },
  { 0X6F, 0X4F },
  { 0X70, 0X50 },
  { 0X71, 0X51 },
  { 0X72, 0X52 },
  { 0X73, 0X53 },
  { 0X74, 0X54 },
  { 0X75, 0X55 },
  { 0X76, 0X56 },
  { 0X77, 0X57 },
  { 0X78, 0X58 },
  { 0X79, 0X59 },
  { 0X7A, 0X5A },
  { 0XB5, 0X39C },
  { 0XE0, 0XC0 },
  { 0XE1, 0XC1 },
  { 0XE2, 0XC2 },
  { 0XE3, 0XC3 },
  { 0XE4, 0XC4 },
  { 0XE5, 0XC5 },
  { 0XE6, 0XC6 },
  { 0XE7, 0XC7 },
  { 0XE8, 0XC8 },
  { 0XE9, 0XC9 },
  { 0XEA, 0XCA },
  { 0XEB, 0XCB },
  { 0XEC, 0XCC },
  { 0XED, 0XCD },
  { 0XEE, 0XCE },
  { 0XEF, 0XCF },
  { 0XF0, 0XD0 },
  { 0XF1, 0XD1 },
  { 0XF2, 0XD2 },
  { 0XF3, 0XD3 },
  { 0XF4, 0XD4 },
  { 0XF5, 0XD5 },
  { 0XF6, 0XD6 },
  { 0XF8, 0XD8 },
  { 0XF9, 0XD9 },
  { 0XFA, 0XDA },
  { 0XFB, 0XDB },
  { 0XFC, 0XDC },
  { 0XFD, 0XDD },
  { 0XFE, 0XDE },
  { 0XFF, 0X178 },
  { 0X101, 0X100 },
  { 0X103, 0X102 },
  { 0X105, 0X104 },
  { 0X107, 0X106 },
  { 0X109, 0X108 },
  { 0X10B, 0X10A },
  { 0X10D, 0X10C },
  { 0X10F, 0X10E },
  { 0X111, 0X110 },
  { 0X113, 0X112 },
  { 0X115, 0X114 },
  { 0X117, 0X116 },
  { 0X119, 0X118 },
  { 0X11B, 0X11A },
  { 0X11D, 0X11C },
  { 0X11F, 0X11E },
  { 0X121, 0X120 },
  { 0X123, 0X122 },
  { 0X125, 0X124 },
  { 0X127, 0X126 },
  { 0X129, 0X128 },
  { 0X12B, 0X12A },
  { 0X12D, 0X12C },
  { 0X12F, 0X12E },
  { 0X131, 0X49 },
  { 0X133, 0X132 },
  { 0X135, 0X134 },
  { 0X137, 0X136 },
  { 0X13A, 0X139 },
  { 0X13C, 0X13B },
  { 0X13E, 0X13D },
  { 0X140, 0X13F },
  { 0X142, 0X141 },
  { 0X144, 0X143 },
  { 0X146, 0X145 },
  { 0X148, 0X147 },
  { 0X14B, 0X14A },
  { 0X14D, 0X14C },
  { 0X14F, 0X14E },
  { 0X151, 0X150 },
  { 0X153, 0X152 },
  { 0X155, 0X154 },
  { 0X157, 0X156 },
  { 0X159, 0X158 },
  { 0X15B, 0X15A },
  { 0X15D, 0X15C },
  { 0X15F, 0X15E },
  { 0X161, 0X160 },
  { 0X163, 0X162 },
  { 0X165, 0X164 },
  { 0X167, 0X166 },
  { 0X169, 0X168 },
  { 0X16B, 0X16A },
  { 0X16D, 0X16C },
  { 0X16F, 0X16E },
  { 0X171, 0X170 },
  { 0X173, 0X172 },
  { 0X175, 0X174 },
  { 0X177, 0X176 },
  { 0X17A, 0X179 },
  { 0X17C, 0X17B },
  { 0X17E, 0X17D },
  { 0X17F, 0X53 },
  { 0X183, 0X182 },
  { 0X185, 0X184 },
  { 0X188, 0X187 },
  { 0X18C, 0X18B },
  { 0X192, 0X191 },
  { 0X195, 0X1F6 },
  { 0X199, 0X198 },
  { 0X1A1, 0X1A0 },
  { 0X1A3, 0X1A2 },
  { 0X1A5, 0X1A4 },
  { 0X1A8, 0X1A7 },
  { 0X1AD, 0X1AC },
  { 0X1B0, 0X1AF },
  { 0X1B4, 0X1B3 },
  { 0X1B6, 0X1B5 },
  { 0X1B9, 0X1B8 },
  { 0X1BD, 0X1BC },
  { 0X1BF, 0X1F7 },
  { 0X1C5, 0X1C4 },
  { 0X1C6, 0X1C4 },
  { 0X1C8, 0X1C7 },
  { 0X1C9, 0X1C7 },
  { 0X1CB, 0X1CA },
  { 0X1CC, 0X1CA },
  { 0X1CE, 0X1CD },
  { 0X1D0, 0X1CF },
  { 0X1D2, 0X1D1 },
  { 0X1D4, 0X1D3 },
  { 0X1D6, 0X1D5 },
  { 0X1D8, 0X1D7 },
  { 0X1DA, 0X1D9 },
  { 0X1DC, 0X1DB },
  { 0X1DD, 0X18E },
  { 0X1DF, 0X1DE },
  { 0X1E1, 0X1E0 },
  { 0X1E3, 0X1E2 },
  { 0X1E5, 0X1E4 },
  { 0X1E7, 0X1E6 },
  { 0X1E9, 0X1E8 },
  { 0X1EB, 0X1EA },
  { 0X1ED, 0X1EC },
  { 0X1EF, 0X1EE },
  { 0X1F2, 0X1F1 },
  { 0X1F3, 0X1F1 },
  { 0X1F5, 0X1F4 },
  { 0X1F9, 0X1F8 },
  { 0X1FB, 0X1FA },
  { 0X1FD, 0X1FC },
  { 0X1FF, 0X1FE },
  { 0X201, 0X200 },
  { 0X203, 0X202 },
  { 0X205, 0X204 },
  { 0X207, 0X206 },
  { 0X209, 0X208 },
  { 0X20B, 0X20A },
  { 0X20D, 0X20C },
  { 0X20F, 0X20E },
  { 0X211, 0X210 },
  { 0X213, 0X212 },
  { 0X215, 0X214 },
  { 0X217, 0X216 },
  { 0X219, 0X218 },
  { 0X21B, 0X21A },
  { 0X21D, 0X21C },
  { 0X21F, 0X21E },
  { 0X223, 0X222 },
  { 0X225, 0X224 },
  { 0X227, 0X226 },
  { 0X229, 0X228 },
  { 0X22B, 0X22A },
  { 0X22D, 0X22C },
  { 0X22F, 0X22E },
  { 0X231, 0X230 },
  { 0X233, 0X232 },
  { 0X253, 0X181 },
  { 0X254, 0X186 },
  { 0X256, 0X189 },
  { 0X257, 0X18A },
  { 0X259, 0X18F },
  { 0X25B, 0X190 },
  { 0X260, 0X193 },
  { 0X263, 0X194 },
  { 0X268, 0X197 },
  { 0X269, 0X196 },
  { 0X26F, 0X19C },
  { 0X272, 0X19D },
  { 0X275, 0X19F },
  { 0X280, 0X1A6 },
  { 0X283, 0X1A9 },
  { 0X288, 0X1AE },
  { 0X28A, 0X1B1 },
  { 0X28B, 0X1B2 },
  { 0X292, 0X1B7 },
  { 0X345, 0X399 },
  { 0X3AC, 0X386 },
  { 0X3AD, 0X388 },
  { 0X3AE, 0X389 },
  { 0X3AF, 0X38A },
  { 0X3B1, 0X391 },
  { 0X3B2, 0X392 },
  { 0X3B3, 0X393 },
  { 0X3B4, 0X394 },
  { 0X3B5, 0X395 },
  { 0X3B6, 0X396 },
  { 0X3B7, 0X397 },
  { 0X3B8, 0X398 },
  { 0X3B9, 0X399 },
  { 0X3BA, 0X39A },
  { 0X3BB, 0X39B },
  { 0X3BC, 0X39C },
  { 0X3BD, 0X39D },
  { 0X3BE, 0X39E },
  { 0X3BF, 0X39F },
  { 0X3C0, 0X3A0 },
  { 0X3C1, 0X3A1 },
  { 0X3C2, 0X3A3 },
  { 0X3C3, 0X3A3 },
  { 0X3C4, 0X3A4 },
  { 0X3C5, 0X3A5 },
  { 0X3C6, 0X3A6 },
  { 0X3C7, 0X3A7 },
  { 0X3C8, 0X3A8 },
  { 0X3C9, 0X3A9 },
  { 0X3CA, 0X3AA },
  { 0X3CB, 0X3AB },
  { 0X3CC, 0X38C },
  { 0X3CD, 0X38E },
  { 0X3CE, 0X38F },
  { 0X3D0, 0X392 },
  { 0X3D1, 0X398 },
  { 0X3D5, 0X3A6 },
  { 0X3D6, 0X3A0 },
  { 0X3DB, 0X3DA },
  { 0X3DD, 0X3DC },
  { 0X3DF, 0X3DE },
  { 0X3E1, 0X3E0 },
  { 0X3E3, 0X3E2 },
  { 0X3E5, 0X3E4 },
  { 0X3E7, 0X3E6 },
  { 0X3E9, 0X3E8 },
  { 0X3EB, 0X3EA },
  { 0X3ED, 0X3EC },
  { 0X3EF, 0X3EE },
  { 0X3F0, 0X39A },
  { 0X3F1, 0X3A1 },
  { 0X3F2, 0X3A3 },
  { 0X430, 0X410 },
  { 0X431, 0X411 },
  { 0X432, 0X412 },
  { 0X433, 0X413 },
  { 0X434, 0X414 },
  { 0X435, 0X415 },
  { 0X436, 0X416 },
  { 0X437, 0X417 },
  { 0X438, 0X418 },
  { 0X439, 0X419 },
  { 0X43A, 0X41A },
  { 0X43B, 0X41B },
  { 0X43C, 0X41C },
  { 0X43D, 0X41D },
  { 0X43E, 0X41E },
  { 0X43F, 0X41F },
  { 0X440, 0X420 },
  { 0X441, 0X421 },
  { 0X442, 0X422 },
  { 0X443, 0X423 },
  { 0X444, 0X424 },
  { 0X445, 0X425 },
  { 0X446, 0X426 },
  { 0X447, 0X427 },
  { 0X448, 0X428 },
  { 0X449, 0X429 },
  { 0X44A, 0X42A },
  { 0X44B, 0X42B },
  { 0X44C, 0X42C },
  { 0X44D, 0X42D },
  { 0X44E, 0X42E },
  { 0X44F, 0X42F },
  { 0X450, 0X400 },
  { 0X451, 0X401 },
  { 0X452, 0X402 },
  { 0X453, 0X403 },
  { 0X454, 0X404 },
  { 0X455, 0X405 },
  { 0X456, 0X406 },
  { 0X457, 0X407 },
  { 0X458, 0X408 },
  { 0X459, 0X409 },
  { 0X45A, 0X40A },
  { 0X45B, 0X40B },
  { 0X45C, 0X40C },
  { 0X45D, 0X40D },
  { 0X45E, 0X40E },
  { 0X45F, 0X40F },
  { 0X461, 0X460 },
  { 0X463, 0X462 },
  { 0X465, 0X464 },
  { 0X467, 0X466 },
  { 0X469, 0X468 },
  { 0X46B, 0X46A },
  { 0X46D, 0X46C },
  { 0X46F, 0X46E },
  { 0X471, 0X470 },
  { 0X473, 0X472 },
  { 0X475, 0X474 },
  { 0X477, 0X476 },
  { 0X479, 0X478 },
  { 0X47B, 0X47A },
  { 0X47D, 0X47C },
  { 0X47F, 0X47E },
  { 0X481, 0X480 },
  { 0X48D, 0X48C },
  { 0X48F, 0X48E },
  { 0X491, 0X490 },
  { 0X493, 0X492 },
  { 0X495, 0X494 },
  { 0X497, 0X496 },
  { 0X499, 0X498 },
  { 0X49B, 0X49A },
  { 0X49D, 0X49C },
  { 0X49F, 0X49E },
  { 0X4A1, 0X4A0 },
  { 0X4A3, 0X4A2 },
  { 0X4A5, 0X4A4 },
  { 0X4A7, 0X4A6 },
  { 0X4A9, 0X4A8 },
  { 0X4AB, 0X4AA },
  { 0X4AD, 0X4AC },
  { 0X4AF, 0X4AE },
  { 0X4B1, 0X4B0 },
  { 0X4B3, 0X4B2 },
  { 0X4B5, 0X4B4 },
  { 0X4B7, 0X4B6 },
  { 0X4B9, 0X4B8 },
  { 0X4BB, 0X4BA },
  { 0X4BD, 0X4BC },
  { 0X4BF, 0X4BE },
  { 0X4C2, 0X4C1 },
  { 0X4C4, 0X4C3 },
  { 0X4C8, 0X4C7 },
  { 0X4CC, 0X4CB },
  { 0X4D1, 0X4D0 },
  { 0X4D3, 0X4D2 },
  { 0X4D5, 0X4D4 },
  { 0X4D7, 0X4D6 },
  { 0X4D9, 0X4D8 },
  { 0X4DB, 0X4DA },
  { 0X4DD, 0X4DC },
  { 0X4DF, 0X4DE },
  { 0X4E1, 0X4E0 },
  { 0X4E3, 0X4E2 },
  { 0X4E5, 0X4E4 },
  { 0X4E7, 0X4E6 },
  { 0X4E9, 0X4E8 },
  { 0X4EB, 0X4EA },
  { 0X4ED, 0X4EC },
  { 0X4EF, 0X4EE },
  { 0X4F1, 0X4F0 },
  { 0X4F3, 0X4F2 },
  { 0X4F5, 0X4F4 },
  { 0X4F9, 0X4F8 },
  { 0X561, 0X531 },
  { 0X562, 0X532 },
  { 0X563, 0X533 },
  { 0X564, 0X534 },
  { 0X565, 0X535 },
  { 0X566, 0X536 },
  { 0X567, 0X537 },
  { 0X568, 0X538 },
  { 0X569, 0X539 },
  { 0X56A, 0X53A },
  { 0X56B, 0X53B },
  { 0X56C, 0X53C },
  { 0X56D, 0X53D },
  { 0X56E, 0X53E },
  { 0X56F, 0X53F },
  { 0X570, 0X540 },
  { 0X571, 0X541 },
  { 0X572, 0X542 },
  { 0X573, 0X543 },
  { 0X574, 0X544 },
  { 0X575, 0X545 },
  { 0X576, 0X546 },
  { 0X577, 0X547 },
  { 0X578, 0X548 },
  { 0X579, 0X549 },
  { 0X57A, 0X54A },
  { 0X57B, 0X54B },
  { 0X57C, 0X54C },
  { 0X57D, 0X54D },
  { 0X57E, 0X54E },
  { 0X57F, 0X54F },
  { 0X580, 0X550 },
  { 0X581, 0X551 },
  { 0X582, 0X552 },
  { 0X583, 0X553 },
  { 0X584, 0X554 },
  { 0X585, 0X555 },
  { 0X586, 0X556 },
  { 0X1E01, 0X1E00 },
  { 0X1E03, 0X1E02 },
  { 0X1E05, 0X1E04 },
  { 0X1E07, 0X1E06 },
  { 0X1E09, 0X1E08 },
  { 0X1E0B, 0X1E0A },
  { 0X1E0D, 0X1E0C },
  { 0X1E0F, 0X1E0E },
  { 0X1E11, 0X1E10 },
  { 0X1E13, 0X1E12 },
  { 0X1E15, 0X1E14 },
  { 0X1E17, 0X1E16 },
  { 0X1E19, 0X1E18 },
  { 0X1E1B, 0X1E1A },
  { 0X1E1D, 0X1E1C },
  { 0X1E1F, 0X1E1E },
  { 0X1E21, 0X1E20 },
  { 0X1E23, 0X1E22 },
  { 0X1E25, 0X1E24 },
  { 0X1E27, 0X1E26 },
  { 0X1E29, 0X1E28 },
  { 0X1E2B, 0X1E2A },
  { 0X1E2D, 0X1E2C },
  { 0X1E2F, 0X1E2E },
  { 0X1E31, 0X1E30 },
  { 0X1E33, 0X1E32 },
  { 0X1E35, 0X1E34 },
  { 0X1E37, 0X1E36 },
  { 0X1E39, 0X1E38 },
  { 0X1E3B, 0X1E3A },
  { 0X1E3D, 0X1E3C },
  { 0X1E3F, 0X1E3E },
  { 0X1E41, 0X1E40 },
  { 0X1E43, 0X1E42 },
  { 0X1E45, 0X1E44 },
  { 0X1E47, 0X1E46 },
  { 0X1E49, 0X1E48 },
  { 0X1E4B, 0X1E4A },
  { 0X1E4D, 0X1E4C },
  { 0X1E4F, 0X1E4E },
  { 0X1E51, 0X1E50 },
  { 0X1E53, 0X1E52 },
  { 0X1E55, 0X1E54 },
  { 0X1E57, 0X1E56 },
  { 0X1E59, 0X1E58 },
  { 0X1E5B, 0X1E5A },
  { 0X1E5D, 0X1E5C },
  { 0X1E5F, 0X1E5E },
  { 0X1E61, 0X1E60 },
  { 0X1E63, 0X1E62 },
  { 0X1E65, 0X1E64 },
  { 0X1E67, 0X1E66 },
  { 0X1E69, 0X1E68 },
  { 0X1E6B, 0X1E6A },
  { 0X1E6D, 0X1E6C },
  { 0X1E6F, 0X1E6E },
  { 0X1E71, 0X1E70 },
  { 0X1E73, 0X1E72 },
  { 0X1E75, 0X1E74 },
  { 0X1E77, 0X1E76 },
  { 0X1E79, 0X1E78 },
  { 0X1E7B, 0X1E7A },
  { 0X1E7D, 0X1E7C },
  { 0X1E7F, 0X1E7E },
  { 0X1E81, 0X1E80 },
  { 0X1E83, 0X1E82 },
  { 0X1E85, 0X1E84 },
  { 0X1E87, 0X1E86 },
  { 0X1E89, 0X1E88 },
  { 0X1E8B, 0X1E8A },
  { 0X1E8D, 0X1E8C },
  { 0X1E8F, 0X1E8E },
  { 0X1E91, 0X1E90 },
  { 0X1E93, 0X1E92 },
  { 0X1E95, 0X1E94 },
  { 0X1E9B, 0X1E60 },
  { 0X1EA1, 0X1EA0 },
  { 0X1EA3, 0X1EA2 },
  { 0X1EA5, 0X1EA4 },
  { 0X1EA7, 0X1EA6 },
  { 0X1EA9, 0X1EA8 },
  { 0X1EAB, 0X1EAA },
  { 0X1EAD, 0X1EAC },
  { 0X1EAF, 0X1EAE },
  { 0X1EB1, 0X1EB0 },
  { 0X1EB3, 0X1EB2 },
  { 0X1EB5, 0X1EB4 },
  { 0X1EB7, 0X1EB6 },
  { 0X1EB9, 0X1EB8 },
  { 0X1EBB, 0X1EBA },
  { 0X1EBD, 0X1EBC },
  { 0X1EBF, 0X1EBE },
  { 0X1EC1, 0X1EC0 },
  { 0X1EC3, 0X1EC2 },
  { 0X1EC5, 0X1EC4 },
  { 0X1EC7, 0X1EC6 },
  { 0X1EC9, 0X1EC8 },
  { 0X1ECB, 0X1ECA },
  { 0X1ECD, 0X1ECC },
  { 0X1ECF, 0X1ECE },
  { 0X1ED1, 0X1ED0 },
  { 0X1ED3, 0X1ED2 },
  { 0X1ED5, 0X1ED4 },
  { 0X1ED7, 0X1ED6 },
  { 0X1ED9, 0X1ED8 },
  { 0X1EDB, 0X1EDA },
  { 0X1EDD, 0X1EDC },
  { 0X1EDF, 0X1EDE },
  { 0X1EE1, 0X1EE0 },
  { 0X1EE3, 0X1EE2 },
  { 0X1EE5, 0X1EE4 },
  { 0X1EE7, 0X1EE6 },
  { 0X1EE9, 0X1EE8 },
  { 0X1EEB, 0X1EEA },
  { 0X1EED, 0X1EEC },
  { 0X1EEF, 0X1EEE },
  { 0X1EF1, 0X1EF0 },
  { 0X1EF3, 0X1EF2 },
  { 0X1EF5, 0X1EF4 },
  { 0X1EF7, 0X1EF6 },
  { 0X1EF9, 0X1EF8 },
  { 0X1F00, 0X1F08 },
  { 0X1F01, 0X1F09 },
  { 0X1F02, 0X1F0A },
  { 0X1F03, 0X1F0B },
  { 0X1F04, 0X1F0C },
  { 0X1F05, 0X1F0D },
  { 0X1F06, 0X1F0E },
  { 0X1F07, 0X1F0F },
  { 0X1F10, 0X1F18 },
  { 0X1F11, 0X1F19 },
  { 0X1F12, 0X1F1A },
  { 0X1F13, 0X1F1B },
  { 0X1F14, 0X1F1C },
  { 0X1F15, 0X1F1D },
  { 0X1F20, 0X1F28 },
  { 0X1F21, 0X1F29 },
  { 0X1F22, 0X1F2A },
  { 0X1F23, 0X1F2B },
  { 0X1F24, 0X1F2C },
  { 0X1F25, 0X1F2D },
  { 0X1F26, 0X1F2E },
  { 0X1F27, 0X1F2F },
  { 0X1F30, 0X1F38 },
  { 0X1F31, 0X1F39 },
  { 0X1F32, 0X1F3A },
  { 0X1F33, 0X1F3B },
  { 0X1F34, 0X1F3C },
  { 0X1F35, 0X1F3D },
  { 0X1F36, 0X1F3E },
  { 0X1F37, 0X1F3F },
  { 0X1F40, 0X1F48 },
  { 0X1F41, 0X1F49 },
  { 0X1F42, 0X1F4A },
  { 0X1F43, 0X1F4B },
  { 0X1F44, 0X1F4C },
  { 0X1F45, 0X1F4D },
  { 0X1F51, 0X1F59 },
  { 0X1F53, 0X1F5B },
  { 0X1F55, 0X1F5D },
  { 0X1F57, 0X1F5F },
  { 0X1F60, 0X1F68 },
  { 0X1F61, 0X1F69 },
  { 0X1F62, 0X1F6A },
  { 0X1F63, 0X1F6B },
  { 0X1F64, 0X1F6C },
  { 0X1F65, 0X1F6D },
  { 0X1F66, 0X1F6E },
  { 0X1F67, 0X1F6F },
  { 0X1F70, 0X1FBA },
  { 0X1F71, 0X1FBB },
  { 0X1F72, 0X1FC8 },
  { 0X1F73, 0X1FC9 },
  { 0X1F74, 0X1FCA },
  { 0X1F75, 0X1FCB },
  { 0X1F76, 0X1FDA },
  { 0X1F77, 0X1FDB },
  { 0X1F78, 0X1FF8 },
  { 0X1F79, 0X1FF9 },
  { 0X1F7A, 0X1FEA },
  { 0X1F7B, 0X1FEB },
  { 0X1F7C, 0X1FFA },
  { 0X1F7D, 0X1FFB },
  { 0X1F80, 0X1F88 },
  { 0X1F81, 0X1F89 },
  { 0X1F82, 0X1F8A },
  { 0X1F83, 0X1F8B },
  { 0X1F84, 0X1F8C },
  { 0X1F85, 0X1F8D },
  { 0X1F86, 0X1F8E },
  { 0X1F87, 0X1F8F },
  { 0X1F90, 0X1F98 },
  { 0X1F91, 0X1F99 },
  { 0X1F92, 0X1F9A },
  { 0X1F93, 0X1F9B },
  { 0X1F94, 0X1F9C },
  { 0X1F95, 0X1F9D },
  { 0X1F96, 0X1F9E },
  { 0X1F97, 0X1F9F },
  { 0X1FA0, 0X1FA8 },
  { 0X1FA1, 0X1FA9 },
  { 0X1FA2, 0X1FAA },
  { 0X1FA3, 0X1FAB },
  { 0X1FA4, 0X1FAC },
  { 0X1FA5, 0X1FAD },
  { 0X1FA6, 0X1FAE },
  { 0X1FA7, 0X1FAF },
  { 0X1FB0, 0X1FB8 },
  { 0X1FB1, 0X1FB9 },
  { 0X1FB3, 0X1FBC },
  { 0X1FBE, 0X399 },
  { 0X1FC3, 0X1FCC },
  { 0X1FD0, 0X1FD8 },
  { 0X1FD1, 0X1FD9 },
  { 0X1FE0, 0X1FE8 },
  { 0X1FE1, 0X1FE9 },
  { 0X1FE5, 0X1FEC },
  { 0X1FF3, 0X1FFC },
  { 0X2170, 0X2160 },
  { 0X2171, 0X2161 },
  { 0X2172, 0X2162 },
  { 0X2173, 0X2163 },
  { 0X2174, 0X2164 },
  { 0X2175, 0X2165 },
  { 0X2176, 0X2166 },
  { 0X2177, 0X2167 },
  { 0X2178, 0X2168 },
  { 0X2179, 0X2169 },
  { 0X217A, 0X216A },
  { 0X217B, 0X216B },
  { 0X217C, 0X216C },
  { 0X217D, 0X216D },
  { 0X217E, 0X216E },
  { 0X217F, 0X216F },
  { 0X24D0, 0X24B6 },
  { 0X24D1, 0X24B7 },
  { 0X24D2, 0X24B8 },
  { 0X24D3, 0X24B9 },
  { 0X24D4, 0X24BA },
  { 0X24D5, 0X24BB },
  { 0X24D6, 0X24BC },
  { 0X24D7, 0X24BD },
  { 0X24D8, 0X24BE },
  { 0X24D9, 0X24BF },
  { 0X24DA, 0X24C0 },
  { 0X24DB, 0X24C1 },
  { 0X24DC, 0X24C2 },
  { 0X24DD, 0X24C3 },
  { 0X24DE, 0X24C4 },
  { 0X24DF, 0X24C5 },
  { 0X24E0, 0X24C6 },
  { 0X24E1, 0X24C7 },
  { 0X24E2, 0X24C8 },
  { 0X24E3, 0X24C9 },
  { 0X24E4, 0X24CA },
  { 0X24E5, 0X24CB },
  { 0X24E6, 0X24CC },
  { 0X24E7, 0X24CD },
  { 0X24E8, 0X24CE },
  { 0X24E9, 0X24CF },
  { 0XFF41, 0XFF21 },
  { 0XFF42, 0XFF22 },
  { 0XFF43, 0XFF23 },
  { 0XFF44, 0XFF24 },
  { 0XFF45, 0XFF25 },
  { 0XFF46, 0XFF26 },
  { 0XFF47, 0XFF27 },
  { 0XFF48, 0XFF28 },
  { 0XFF49, 0XFF29 },
  { 0XFF4A, 0XFF2A },
  { 0XFF4B, 0XFF2B },
  { 0XFF4C, 0XFF2C },
  { 0XFF4D, 0XFF2D },
  { 0XFF4E, 0XFF2E },
  { 0XFF4F, 0XFF2F },
  { 0XFF50, 0XFF30 },
  { 0XFF51, 0XFF31 },
  { 0XFF52, 0XFF32 },
  { 0XFF53, 0XFF33 },
  { 0XFF54, 0XFF34 },
  { 0XFF55, 0XFF35 },
  { 0XFF56, 0XFF36 },
  { 0XFF57, 0XFF37 },
  { 0XFF58, 0XFF38 },
  { 0XFF59, 0XFF39 },
  { 0XFF5A, 0XFF3A }
};

int ksm_unicode_toupper(int ch)
{
  pair *p;

  if( ch >= 0 && ch <= 0x7f )
    return toupper(ch);
  p = bsearch_pair(ch, to_upper, sizeof(to_upper)/sizeof(pair));
  return p ? p->right : ch;
}

static pair to_lower[] = {   /*** GLOBAL ***/
  { 0X41, 0X61 },
  { 0X42, 0X62 },
  { 0X43, 0X63 },
  { 0X44, 0X64 },
  { 0X45, 0X65 },
  { 0X46, 0X66 },
  { 0X47, 0X67 },
  { 0X48, 0X68 },
  { 0X49, 0X69 },
  { 0X4A, 0X6A },
  { 0X4B, 0X6B },
  { 0X4C, 0X6C },
  { 0X4D, 0X6D },
  { 0X4E, 0X6E },
  { 0X4F, 0X6F },
  { 0X50, 0X70 },
  { 0X51, 0X71 },
  { 0X52, 0X72 },
  { 0X53, 0X73 },
  { 0X54, 0X74 },
  { 0X55, 0X75 },
  { 0X56, 0X76 },
  { 0X57, 0X77 },
  { 0X58, 0X78 },
  { 0X59, 0X79 },
  { 0X5A, 0X7A },
  { 0XC0, 0XE0 },
  { 0XC1, 0XE1 },
  { 0XC2, 0XE2 },
  { 0XC3, 0XE3 },
  { 0XC4, 0XE4 },
  { 0XC5, 0XE5 },
  { 0XC6, 0XE6 },
  { 0XC7, 0XE7 },
  { 0XC8, 0XE8 },
  { 0XC9, 0XE9 },
  { 0XCA, 0XEA },
  { 0XCB, 0XEB },
  { 0XCC, 0XEC },
  { 0XCD, 0XED },
  { 0XCE, 0XEE },
  { 0XCF, 0XEF },
  { 0XD0, 0XF0 },
  { 0XD1, 0XF1 },
  { 0XD2, 0XF2 },
  { 0XD3, 0XF3 },
  { 0XD4, 0XF4 },
  { 0XD5, 0XF5 },
  { 0XD6, 0XF6 },
  { 0XD8, 0XF8 },
  { 0XD9, 0XF9 },
  { 0XDA, 0XFA },
  { 0XDB, 0XFB },
  { 0XDC, 0XFC },
  { 0XDD, 0XFD },
  { 0XDE, 0XFE },
  { 0X100, 0X101 },
  { 0X102, 0X103 },
  { 0X104, 0X105 },
  { 0X106, 0X107 },
  { 0X108, 0X109 },
  { 0X10A, 0X10B },
  { 0X10C, 0X10D },
  { 0X10E, 0X10F },
  { 0X110, 0X111 },
  { 0X112, 0X113 },
  { 0X114, 0X115 },
  { 0X116, 0X117 },
  { 0X118, 0X119 },
  { 0X11A, 0X11B },
  { 0X11C, 0X11D },
  { 0X11E, 0X11F },
  { 0X120, 0X121 },
  { 0X122, 0X123 },
  { 0X124, 0X125 },
  { 0X126, 0X127 },
  { 0X128, 0X129 },
  { 0X12A, 0X12B },
  { 0X12C, 0X12D },
  { 0X12E, 0X12F },
  { 0X130, 0X69 },
  { 0X132, 0X133 },
  { 0X134, 0X135 },
  { 0X136, 0X137 },
  { 0X139, 0X13A },
  { 0X13B, 0X13C },
  { 0X13D, 0X13E },
  { 0X13F, 0X140 },
  { 0X141, 0X142 },
  { 0X143, 0X144 },
  { 0X145, 0X146 },
  { 0X147, 0X148 },
  { 0X14A, 0X14B },
  { 0X14C, 0X14D },
  { 0X14E, 0X14F },
  { 0X150, 0X151 },
  { 0X152, 0X153 },
  { 0X154, 0X155 },
  { 0X156, 0X157 },
  { 0X158, 0X159 },
  { 0X15A, 0X15B },
  { 0X15C, 0X15D },
  { 0X15E, 0X15F },
  { 0X160, 0X161 },
  { 0X162, 0X163 },
  { 0X164, 0X165 },
  { 0X166, 0X167 },
  { 0X168, 0X169 },
  { 0X16A, 0X16B },
  { 0X16C, 0X16D },
  { 0X16E, 0X16F },
  { 0X170, 0X171 },
  { 0X172, 0X173 },
  { 0X174, 0X175 },
  { 0X176, 0X177 },
  { 0X178, 0XFF },
  { 0X179, 0X17A },
  { 0X17B, 0X17C },
  { 0X17D, 0X17E },
  { 0X181, 0X253 },
  { 0X182, 0X183 },
  { 0X184, 0X185 },
  { 0X186, 0X254 },
  { 0X187, 0X188 },
  { 0X189, 0X256 },
  { 0X18A, 0X257 },
  { 0X18B, 0X18C },
  { 0X18E, 0X1DD },
  { 0X18F, 0X259 },
  { 0X190, 0X25B },
  { 0X191, 0X192 },
  { 0X193, 0X260 },
  { 0X194, 0X263 },
  { 0X196, 0X269 },
  { 0X197, 0X268 },
  { 0X198, 0X199 },
  { 0X19C, 0X26F },
  { 0X19D, 0X272 },
  { 0X19F, 0X275 },
  { 0X1A0, 0X1A1 },
  { 0X1A2, 0X1A3 },
  { 0X1A4, 0X1A5 },
  { 0X1A6, 0X280 },
  { 0X1A7, 0X1A8 },
  { 0X1A9, 0X283 },
  { 0X1AC, 0X1AD },
  { 0X1AE, 0X288 },
  { 0X1AF, 0X1B0 },
  { 0X1B1, 0X28A },
  { 0X1B2, 0X28B },
  { 0X1B3, 0X1B4 },
  { 0X1B5, 0X1B6 },
  { 0X1B7, 0X292 },
  { 0X1B8, 0X1B9 },
  { 0X1BC, 0X1BD },
  { 0X1C4, 0X1C6 },
  { 0X1C5, 0X1C6 },
  { 0X1C7, 0X1C9 },
  { 0X1C8, 0X1C9 },
  { 0X1CA, 0X1CC },
  { 0X1CB, 0X1CC },
  { 0X1CD, 0X1CE },
  { 0X1CF, 0X1D0 },
  { 0X1D1, 0X1D2 },
  { 0X1D3, 0X1D4 },
  { 0X1D5, 0X1D6 },
  { 0X1D7, 0X1D8 },
  { 0X1D9, 0X1DA },
  { 0X1DB, 0X1DC },
  { 0X1DE, 0X1DF },
  { 0X1E0, 0X1E1 },
  { 0X1E2, 0X1E3 },
  { 0X1E4, 0X1E5 },
  { 0X1E6, 0X1E7 },
  { 0X1E8, 0X1E9 },
  { 0X1EA, 0X1EB },
  { 0X1EC, 0X1ED },
  { 0X1EE, 0X1EF },
  { 0X1F1, 0X1F3 },
  { 0X1F2, 0X1F3 },
  { 0X1F4, 0X1F5 },
  { 0X1F6, 0X195 },
  { 0X1F7, 0X1BF },
  { 0X1F8, 0X1F9 },
  { 0X1FA, 0X1FB },
  { 0X1FC, 0X1FD },
  { 0X1FE, 0X1FF },
  { 0X200, 0X201 },
  { 0X202, 0X203 },
  { 0X204, 0X205 },
  { 0X206, 0X207 },
  { 0X208, 0X209 },
  { 0X20A, 0X20B },
  { 0X20C, 0X20D },
  { 0X20E, 0X20F },
  { 0X210, 0X211 },
  { 0X212, 0X213 },
  { 0X214, 0X215 },
  { 0X216, 0X217 },
  { 0X218, 0X219 },
  { 0X21A, 0X21B },
  { 0X21C, 0X21D },
  { 0X21E, 0X21F },
  { 0X222, 0X223 },
  { 0X224, 0X225 },
  { 0X226, 0X227 },
  { 0X228, 0X229 },
  { 0X22A, 0X22B },
  { 0X22C, 0X22D },
  { 0X22E, 0X22F },
  { 0X230, 0X231 },
  { 0X232, 0X233 },
  { 0X386, 0X3AC },
  { 0X388, 0X3AD },
  { 0X389, 0X3AE },
  { 0X38A, 0X3AF },
  { 0X38C, 0X3CC },
  { 0X38E, 0X3CD },
  { 0X38F, 0X3CE },
  { 0X391, 0X3B1 },
  { 0X392, 0X3B2 },
  { 0X393, 0X3B3 },
  { 0X394, 0X3B4 },
  { 0X395, 0X3B5 },
  { 0X396, 0X3B6 },
  { 0X397, 0X3B7 },
  { 0X398, 0X3B8 },
  { 0X399, 0X3B9 },
  { 0X39A, 0X3BA },
  { 0X39B, 0X3BB },
  { 0X39C, 0X3BC },
  { 0X39D, 0X3BD },
  { 0X39E, 0X3BE },
  { 0X39F, 0X3BF },
  { 0X3A0, 0X3C0 },
  { 0X3A1, 0X3C1 },
  { 0X3A3, 0X3C3 },
  { 0X3A4, 0X3C4 },
  { 0X3A5, 0X3C5 },
  { 0X3A6, 0X3C6 },
  { 0X3A7, 0X3C7 },
  { 0X3A8, 0X3C8 },
  { 0X3A9, 0X3C9 },
  { 0X3AA, 0X3CA },
  { 0X3AB, 0X3CB },
  { 0X3DA, 0X3DB },
  { 0X3DC, 0X3DD },
  { 0X3DE, 0X3DF },
  { 0X3E0, 0X3E1 },
  { 0X3E2, 0X3E3 },
  { 0X3E4, 0X3E5 },
  { 0X3E6, 0X3E7 },
  { 0X3E8, 0X3E9 },
  { 0X3EA, 0X3EB },
  { 0X3EC, 0X3ED },
  { 0X3EE, 0X3EF },
  { 0X400, 0X450 },
  { 0X401, 0X451 },
  { 0X402, 0X452 },
  { 0X403, 0X453 },
  { 0X404, 0X454 },
  { 0X405, 0X455 },
  { 0X406, 0X456 },
  { 0X407, 0X457 },
  { 0X408, 0X458 },
  { 0X409, 0X459 },
  { 0X40A, 0X45A },
  { 0X40B, 0X45B },
  { 0X40C, 0X45C },
  { 0X40D, 0X45D },
  { 0X40E, 0X45E },
  { 0X40F, 0X45F },
  { 0X410, 0X430 },
  { 0X411, 0X431 },
  { 0X412, 0X432 },
  { 0X413, 0X433 },
  { 0X414, 0X434 },
  { 0X415, 0X435 },
  { 0X416, 0X436 },
  { 0X417, 0X437 },
  { 0X418, 0X438 },
  { 0X419, 0X439 },
  { 0X41A, 0X43A },
  { 0X41B, 0X43B },
  { 0X41C, 0X43C },
  { 0X41D, 0X43D },
  { 0X41E, 0X43E },
  { 0X41F, 0X43F },
  { 0X420, 0X440 },
  { 0X421, 0X441 },
  { 0X422, 0X442 },
  { 0X423, 0X443 },
  { 0X424, 0X444 },
  { 0X425, 0X445 },
  { 0X426, 0X446 },
  { 0X427, 0X447 },
  { 0X428, 0X448 },
  { 0X429, 0X449 },
  { 0X42A, 0X44A },
  { 0X42B, 0X44B },
  { 0X42C, 0X44C },
  { 0X42D, 0X44D },
  { 0X42E, 0X44E },
  { 0X42F, 0X44F },
  { 0X460, 0X461 },
  { 0X462, 0X463 },
  { 0X464, 0X465 },
  { 0X466, 0X467 },
  { 0X468, 0X469 },
  { 0X46A, 0X46B },
  { 0X46C, 0X46D },
  { 0X46E, 0X46F },
  { 0X470, 0X471 },
  { 0X472, 0X473 },
  { 0X474, 0X475 },
  { 0X476, 0X477 },
  { 0X478, 0X479 },
  { 0X47A, 0X47B },
  { 0X47C, 0X47D },
  { 0X47E, 0X47F },
  { 0X480, 0X481 },
  { 0X48C, 0X48D },
  { 0X48E, 0X48F },
  { 0X490, 0X491 },
  { 0X492, 0X493 },
  { 0X494, 0X495 },
  { 0X496, 0X497 },
  { 0X498, 0X499 },
  { 0X49A, 0X49B },
  { 0X49C, 0X49D },
  { 0X49E, 0X49F },
  { 0X4A0, 0X4A1 },
  { 0X4A2, 0X4A3 },
  { 0X4A4, 0X4A5 },
  { 0X4A6, 0X4A7 },
  { 0X4A8, 0X4A9 },
  { 0X4AA, 0X4AB },
  { 0X4AC, 0X4AD },
  { 0X4AE, 0X4AF },
  { 0X4B0, 0X4B1 },
  { 0X4B2, 0X4B3 },
  { 0X4B4, 0X4B5 },
  { 0X4B6, 0X4B7 },
  { 0X4B8, 0X4B9 },
  { 0X4BA, 0X4BB },
  { 0X4BC, 0X4BD },
  { 0X4BE, 0X4BF },
  { 0X4C1, 0X4C2 },
  { 0X4C3, 0X4C4 },
  { 0X4C7, 0X4C8 },
  { 0X4CB, 0X4CC },
  { 0X4D0, 0X4D1 },
  { 0X4D2, 0X4D3 },
  { 0X4D4, 0X4D5 },
  { 0X4D6, 0X4D7 },
  { 0X4D8, 0X4D9 },
  { 0X4DA, 0X4DB },
  { 0X4DC, 0X4DD },
  { 0X4DE, 0X4DF },
  { 0X4E0, 0X4E1 },
  { 0X4E2, 0X4E3 },
  { 0X4E4, 0X4E5 },
  { 0X4E6, 0X4E7 },
  { 0X4E8, 0X4E9 },
  { 0X4EA, 0X4EB },
  { 0X4EC, 0X4ED },
  { 0X4EE, 0X4EF },
  { 0X4F0, 0X4F1 },
  { 0X4F2, 0X4F3 },
  { 0X4F4, 0X4F5 },
  { 0X4F8, 0X4F9 },
  { 0X531, 0X561 },
  { 0X532, 0X562 },
  { 0X533, 0X563 },
  { 0X534, 0X564 },
  { 0X535, 0X565 },
  { 0X536, 0X566 },
  { 0X537, 0X567 },
  { 0X538, 0X568 },
  { 0X539, 0X569 },
  { 0X53A, 0X56A },
  { 0X53B, 0X56B },
  { 0X53C, 0X56C },
  { 0X53D, 0X56D },
  { 0X53E, 0X56E },
  { 0X53F, 0X56F },
  { 0X540, 0X570 },
  { 0X541, 0X571 },
  { 0X542, 0X572 },
  { 0X543, 0X573 },
  { 0X544, 0X574 },
  { 0X545, 0X575 },
  { 0X546, 0X576 },
  { 0X547, 0X577 },
  { 0X548, 0X578 },
  { 0X549, 0X579 },
  { 0X54A, 0X57A },
  { 0X54B, 0X57B },
  { 0X54C, 0X57C },
  { 0X54D, 0X57D },
  { 0X54E, 0X57E },
  { 0X54F, 0X57F },
  { 0X550, 0X580 },
  { 0X551, 0X581 },
  { 0X552, 0X582 },
  { 0X553, 0X583 },
  { 0X554, 0X584 },
  { 0X555, 0X585 },
  { 0X556, 0X586 },
  { 0X1E00, 0X1E01 },
  { 0X1E02, 0X1E03 },
  { 0X1E04, 0X1E05 },
  { 0X1E06, 0X1E07 },
  { 0X1E08, 0X1E09 },
  { 0X1E0A, 0X1E0B },
  { 0X1E0C, 0X1E0D },
  { 0X1E0E, 0X1E0F },
  { 0X1E10, 0X1E11 },
  { 0X1E12, 0X1E13 },
  { 0X1E14, 0X1E15 },
  { 0X1E16, 0X1E17 },
  { 0X1E18, 0X1E19 },
  { 0X1E1A, 0X1E1B },
  { 0X1E1C, 0X1E1D },
  { 0X1E1E, 0X1E1F },
  { 0X1E20, 0X1E21 },
  { 0X1E22, 0X1E23 },
  { 0X1E24, 0X1E25 },
  { 0X1E26, 0X1E27 },
  { 0X1E28, 0X1E29 },
  { 0X1E2A, 0X1E2B },
  { 0X1E2C, 0X1E2D },
  { 0X1E2E, 0X1E2F },
  { 0X1E30, 0X1E31 },
  { 0X1E32, 0X1E33 },
  { 0X1E34, 0X1E35 },
  { 0X1E36, 0X1E37 },
  { 0X1E38, 0X1E39 },
  { 0X1E3A, 0X1E3B },
  { 0X1E3C, 0X1E3D },
  { 0X1E3E, 0X1E3F },
  { 0X1E40, 0X1E41 },
  { 0X1E42, 0X1E43 },
  { 0X1E44, 0X1E45 },
  { 0X1E46, 0X1E47 },
  { 0X1E48, 0X1E49 },
  { 0X1E4A, 0X1E4B },
  { 0X1E4C, 0X1E4D },
  { 0X1E4E, 0X1E4F },
  { 0X1E50, 0X1E51 },
  { 0X1E52, 0X1E53 },
  { 0X1E54, 0X1E55 },
  { 0X1E56, 0X1E57 },
  { 0X1E58, 0X1E59 },
  { 0X1E5A, 0X1E5B },
  { 0X1E5C, 0X1E5D },
  { 0X1E5E, 0X1E5F },
  { 0X1E60, 0X1E61 },
  { 0X1E62, 0X1E63 },
  { 0X1E64, 0X1E65 },
  { 0X1E66, 0X1E67 },
  { 0X1E68, 0X1E69 },
  { 0X1E6A, 0X1E6B },
  { 0X1E6C, 0X1E6D },
  { 0X1E6E, 0X1E6F },
  { 0X1E70, 0X1E71 },
  { 0X1E72, 0X1E73 },
  { 0X1E74, 0X1E75 },
  { 0X1E76, 0X1E77 },
  { 0X1E78, 0X1E79 },
  { 0X1E7A, 0X1E7B },
  { 0X1E7C, 0X1E7D },
  { 0X1E7E, 0X1E7F },
  { 0X1E80, 0X1E81 },
  { 0X1E82, 0X1E83 },
  { 0X1E84, 0X1E85 },
  { 0X1E86, 0X1E87 },
  { 0X1E88, 0X1E89 },
  { 0X1E8A, 0X1E8B },
  { 0X1E8C, 0X1E8D },
  { 0X1E8E, 0X1E8F },
  { 0X1E90, 0X1E91 },
  { 0X1E92, 0X1E93 },
  { 0X1E94, 0X1E95 },
  { 0X1EA0, 0X1EA1 },
  { 0X1EA2, 0X1EA3 },
  { 0X1EA4, 0X1EA5 },
  { 0X1EA6, 0X1EA7 },
  { 0X1EA8, 0X1EA9 },
  { 0X1EAA, 0X1EAB },
  { 0X1EAC, 0X1EAD },
  { 0X1EAE, 0X1EAF },
  { 0X1EB0, 0X1EB1 },
  { 0X1EB2, 0X1EB3 },
  { 0X1EB4, 0X1EB5 },
  { 0X1EB6, 0X1EB7 },
  { 0X1EB8, 0X1EB9 },
  { 0X1EBA, 0X1EBB },
  { 0X1EBC, 0X1EBD },
  { 0X1EBE, 0X1EBF },
  { 0X1EC0, 0X1EC1 },
  { 0X1EC2, 0X1EC3 },
  { 0X1EC4, 0X1EC5 },
  { 0X1EC6, 0X1EC7 },
  { 0X1EC8, 0X1EC9 },
  { 0X1ECA, 0X1ECB },
  { 0X1ECC, 0X1ECD },
  { 0X1ECE, 0X1ECF },
  { 0X1ED0, 0X1ED1 },
  { 0X1ED2, 0X1ED3 },
  { 0X1ED4, 0X1ED5 },
  { 0X1ED6, 0X1ED7 },
  { 0X1ED8, 0X1ED9 },
  { 0X1EDA, 0X1EDB },
  { 0X1EDC, 0X1EDD },
  { 0X1EDE, 0X1EDF },
  { 0X1EE0, 0X1EE1 },
  { 0X1EE2, 0X1EE3 },
  { 0X1EE4, 0X1EE5 },
  { 0X1EE6, 0X1EE7 },
  { 0X1EE8, 0X1EE9 },
  { 0X1EEA, 0X1EEB },
  { 0X1EEC, 0X1EED },
  { 0X1EEE, 0X1EEF },
  { 0X1EF0, 0X1EF1 },
  { 0X1EF2, 0X1EF3 },
  { 0X1EF4, 0X1EF5 },
  { 0X1EF6, 0X1EF7 },
  { 0X1EF8, 0X1EF9 },
  { 0X1F08, 0X1F00 },
  { 0X1F09, 0X1F01 },
  { 0X1F0A, 0X1F02 },
  { 0X1F0B, 0X1F03 },
  { 0X1F0C, 0X1F04 },
  { 0X1F0D, 0X1F05 },
  { 0X1F0E, 0X1F06 },
  { 0X1F0F, 0X1F07 },
  { 0X1F18, 0X1F10 },
  { 0X1F19, 0X1F11 },
  { 0X1F1A, 0X1F12 },
  { 0X1F1B, 0X1F13 },
  { 0X1F1C, 0X1F14 },
  { 0X1F1D, 0X1F15 },
  { 0X1F28, 0X1F20 },
  { 0X1F29, 0X1F21 },
  { 0X1F2A, 0X1F22 },
  { 0X1F2B, 0X1F23 },
  { 0X1F2C, 0X1F24 },
  { 0X1F2D, 0X1F25 },
  { 0X1F2E, 0X1F26 },
  { 0X1F2F, 0X1F27 },
  { 0X1F38, 0X1F30 },
  { 0X1F39, 0X1F31 },
  { 0X1F3A, 0X1F32 },
  { 0X1F3B, 0X1F33 },
  { 0X1F3C, 0X1F34 },
  { 0X1F3D, 0X1F35 },
  { 0X1F3E, 0X1F36 },
  { 0X1F3F, 0X1F37 },
  { 0X1F48, 0X1F40 },
  { 0X1F49, 0X1F41 },
  { 0X1F4A, 0X1F42 },
  { 0X1F4B, 0X1F43 },
  { 0X1F4C, 0X1F44 },
  { 0X1F4D, 0X1F45 },
  { 0X1F59, 0X1F51 },
  { 0X1F5B, 0X1F53 },
  { 0X1F5D, 0X1F55 },
  { 0X1F5F, 0X1F57 },
  { 0X1F68, 0X1F60 },
  { 0X1F69, 0X1F61 },
  { 0X1F6A, 0X1F62 },
  { 0X1F6B, 0X1F63 },
  { 0X1F6C, 0X1F64 },
  { 0X1F6D, 0X1F65 },
  { 0X1F6E, 0X1F66 },
  { 0X1F6F, 0X1F67 },
  { 0X1F88, 0X1F80 },
  { 0X1F89, 0X1F81 },
  { 0X1F8A, 0X1F82 },
  { 0X1F8B, 0X1F83 },
  { 0X1F8C, 0X1F84 },
  { 0X1F8D, 0X1F85 },
  { 0X1F8E, 0X1F86 },
  { 0X1F8F, 0X1F87 },
  { 0X1F98, 0X1F90 },
  { 0X1F99, 0X1F91 },
  { 0X1F9A, 0X1F92 },
  { 0X1F9B, 0X1F93 },
  { 0X1F9C, 0X1F94 },
  { 0X1F9D, 0X1F95 },
  { 0X1F9E, 0X1F96 },
  { 0X1F9F, 0X1F97 },
  { 0X1FA8, 0X1FA0 },
  { 0X1FA9, 0X1FA1 },
  { 0X1FAA, 0X1FA2 },
  { 0X1FAB, 0X1FA3 },
  { 0X1FAC, 0X1FA4 },
  { 0X1FAD, 0X1FA5 },
  { 0X1FAE, 0X1FA6 },
  { 0X1FAF, 0X1FA7 },
  { 0X1FB8, 0X1FB0 },
  { 0X1FB9, 0X1FB1 },
  { 0X1FBA, 0X1F70 },
  { 0X1FBB, 0X1F71 },
  { 0X1FBC, 0X1FB3 },
  { 0X1FC8, 0X1F72 },
  { 0X1FC9, 0X1F73 },
  { 0X1FCA, 0X1F74 },
  { 0X1FCB, 0X1F75 },
  { 0X1FCC, 0X1FC3 },
  { 0X1FD8, 0X1FD0 },
  { 0X1FD9, 0X1FD1 },
  { 0X1FDA, 0X1F76 },
  { 0X1FDB, 0X1F77 },
  { 0X1FE8, 0X1FE0 },
  { 0X1FE9, 0X1FE1 },
  { 0X1FEA, 0X1F7A },
  { 0X1FEB, 0X1F7B },
  { 0X1FEC, 0X1FE5 },
  { 0X1FF8, 0X1F78 },
  { 0X1FF9, 0X1F79 },
  { 0X1FFA, 0X1F7C },
  { 0X1FFB, 0X1F7D },
  { 0X1FFC, 0X1FF3 },
  { 0X2126, 0X3C9 },
  { 0X212A, 0X6B },
  { 0X212B, 0XE5 },
  { 0X2160, 0X2170 },
  { 0X2161, 0X2171 },
  { 0X2162, 0X2172 },
  { 0X2163, 0X2173 },
  { 0X2164, 0X2174 },
  { 0X2165, 0X2175 },
  { 0X2166, 0X2176 },
  { 0X2167, 0X2177 },
  { 0X2168, 0X2178 },
  { 0X2169, 0X2179 },
  { 0X216A, 0X217A },
  { 0X216B, 0X217B },
  { 0X216C, 0X217C },
  { 0X216D, 0X217D },
  { 0X216E, 0X217E },
  { 0X216F, 0X217F },
  { 0X24B6, 0X24D0 },
  { 0X24B7, 0X24D1 },
  { 0X24B8, 0X24D2 },
  { 0X24B9, 0X24D3 },
  { 0X24BA, 0X24D4 },
  { 0X24BB, 0X24D5 },
  { 0X24BC, 0X24D6 },
  { 0X24BD, 0X24D7 },
  { 0X24BE, 0X24D8 },
  { 0X24BF, 0X24D9 },
  { 0X24C0, 0X24DA },
  { 0X24C1, 0X24DB },
  { 0X24C2, 0X24DC },
  { 0X24C3, 0X24DD },
  { 0X24C4, 0X24DE },
  { 0X24C5, 0X24DF },
  { 0X24C6, 0X24E0 },
  { 0X24C7, 0X24E1 },
  { 0X24C8, 0X24E2 },
  { 0X24C9, 0X24E3 },
  { 0X24CA, 0X24E4 },
  { 0X24CB, 0X24E5 },
  { 0X24CC, 0X24E6 },
  { 0X24CD, 0X24E7 },
  { 0X24CE, 0X24E8 },
  { 0X24CF, 0X24E9 },
  { 0XFF21, 0XFF41 },
  { 0XFF22, 0XFF42 },
  { 0XFF23, 0XFF43 },
  { 0XFF24, 0XFF44 },
  { 0XFF25, 0XFF45 },
  { 0XFF26, 0XFF46 },
  { 0XFF27, 0XFF47 },
  { 0XFF28, 0XFF48 },
  { 0XFF29, 0XFF49 },
  { 0XFF2A, 0XFF4A },
  { 0XFF2B, 0XFF4B },
  { 0XFF2C, 0XFF4C },
  { 0XFF2D, 0XFF4D },
  { 0XFF2E, 0XFF4E },
  { 0XFF2F, 0XFF4F },
  { 0XFF30, 0XFF50 },
  { 0XFF31, 0XFF51 },
  { 0XFF32, 0XFF52 },
  { 0XFF33, 0XFF53 },
  { 0XFF34, 0XFF54 },
  { 0XFF35, 0XFF55 },
  { 0XFF36, 0XFF56 },
  { 0XFF37, 0XFF57 },
  { 0XFF38, 0XFF58 },
  { 0XFF39, 0XFF59 },
  { 0XFF3A, 0XFF5A }
};

int ksm_unicode_tolower(int ch)
{
  pair *p;

  if( ch >= 0 && ch <= 0x7f )
    return tolower(ch);
  p = bsearch_pair(ch, to_lower, sizeof(to_lower)/sizeof(pair));
  return p ? p->right : ch;
}

